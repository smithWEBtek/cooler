function loadCurrentUserData(){$.ajax({method:"get",url:"/current_user_id",dataType:"json"}).done(function(e){$.ajax({url:`/users/${e}`,dataType:"json"}).done(function(e){let t=[...new Set(e.responses.map(e=>e.category.name))].filter(e=>e);t.forEach(e=>{document.getElementById(e).classList.add("completed")});let n=Array.from(document.getElementsByClassName("survey__category-tab")).map(e=>{if(!t.includes(e.id))return e.id}).filter(e=>e);processTabs(t,n)})}),loadCommunityPoints()}function loadSurvey(){surveyJSON.pages.map(e=>{let t=new Survey.Model(e),n=$(`#${e.name}`),o=$(".survey__category-tabs"),r=e.name;n.Survey({model:t,onComplete:saveCategoryResults,category:r}),$.ajax({url:`/img_url/${r}`,dataType:"json"}).done(function(t){o.append(`\n        <div class="category-image">\n          <img id="${e.name}" src="${t.url}" class="survey__category-tab survey__category-tab-image" />\n        </div>`),categoryTabHandler(e.name)})})}function categoryTabHandler(e){$(`#${e}`).on("click",function(e){e.preventDefault();let t=document.getElementById(e.currentTarget.id),n=$(`div#${e.currentTarget.id}`);$(".survey__category-view").css("display","none"),$(".summary__body").css("display","inline"),n.css("display","inline"),t.classList.add("selected"),$(".sv_complete_btn").css("float","left"),$("input.sv_complete_btn").on("click",function(e){e.preventDefault(),t.classList.add("completed")})})}function continueSurvey(){9==$("img.completed").length?surveyMessage("Thank you for your participation! You can download a PDF of your results by clicking on <strong>Account | PDF Summary</strong>."):$("div.landing-page__about").html("<button><strong>CONTINUE SURVEY</strong></button>").on("click",function(e){e.preventDefault()})}function processTabs(e,t){let n=[];e.forEach(e=>{document.getElementById(e).classList.add("completed")}),t.forEach(e=>{let o=document.getElementById(e);o.classList.add("uncompleted"),o.addEventListener("click",function(e){e.preventDefault(),o.classList.add("selected"),(n=t.filter(e=>e!=document.getElementsByClassName("selected")[0].id)).forEach(e=>{document.getElementById(e).classList.add("unclickable")})})}),continueSurvey()}function saveCategoryResults(e){let t={category:e.category,data:e.data};$.post({url:"/responses",dataType:"json",data:t}).done(function(e){$("div.survey__user-total--points")[0].innerText=e.user_total_points,loadCategoryPoints(e.category.id),loadAffiliationPoints(e.user.affiliation_id),loadCommunityPoints(),surveyMessage(e.category.title,e.user_total_points)}),location.reload()}function loadCommunityPoints(){$.ajax({url:"/community_total",dataType:"json"}).done(function(e){$("div.survey__community-total--points")[0].innerText=`${e.community_total}`})}function loadCategoryPoints(e){$.ajax({url:`/category_total/${e}`,dataType:"json"}).done(function(e){$("div.survey__category-total--points")[0].innerText=`${e.category_total}`})}function loadAffiliationPoints(e){$.ajax({url:`/affiliation_total/${e}`,dataType:"json"}).done(function(e){$("div.survey__affiliation-total--points")[0].innerText=`${e.affiliation_total}`})}function msgCategoryComplete(e,t){$("#survey__message")[0].innerHTML=`\n    <div class="survey__message">\n      Thanks for completing the ${e} section.<br />\n      Your chosen actions will reduce Carbon Emissions by: ${t} points!\n    </div>\n  `,$("#survey__message")[0].css("display","inline")}function msgSurveyStart(){$("#survey__message")[0].innerHTML='\n    <div class="landing-page__about">\n    <p><strong>A survey to help you choose actions that reduce your carbon footprint. </strong>It is used to determine\n    the value in points, equivalent to lbs. of CO2 emission or trees. CO2 and cost estimates are based on\n    assumptions of average energy consumption and fuel prices, and are not intended to be exact. See notice below\n    for privacy information.</p>\n    <p>Copyright &copy 2019, Town of Concord Comprehensive Sustainable Energy Committee.</p>\n    </div>\n  ',$("#survey__message")[0].css("display","inline")}function msgSurveyComplete(e,t){$("#survey__message")[0].innerHTML=`\n    <div class="survey__message">\n      Thanks for completing the ${e} section.<br />\n      Your chosen actions will reduce Carbon Emissions by: ${t} points!\n    </div>\n  `,$("#survey__message")[0].css("display","inline")}function surveyMessage(e){$("div.landing-page__about").html(`\n    <div>\n      <h2>${e}</h2>\n    </div>`)}(function(){var e=this;(function(){(function(){this.Rails={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:{selector:"button[data-remote]:not([form]), button[data-confirm]:not([form])",exclude:"form button"},inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",formDisableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",formEnableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]"}}).call(this)}).call(e);var t=e.Rails;(function(){(function(){var e;e=null,t.loadCSPNonce=function(){var t;return e=null!=(t=document.querySelector("meta[name=csp-nonce]"))?t.content:void 0},t.cspNonce=function(){return null!=e?e:t.loadCSPNonce()}}).call(this),function(){var e,n;n=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,t.matches=function(e,t){return null!=t.exclude?n.call(e,t.selector)&&!n.call(e,t.exclude):n.call(e,t)},e="_ujsData",t.getData=function(t,n){var o;return null!=(o=t[e])?o[n]:void 0},t.setData=function(t,n,o){return null==t[e]&&(t[e]={}),t[e][n]=o},t.$=function(e){return Array.prototype.slice.call(document.querySelectorAll(e))}}.call(this),function(){var e,n,o;e=t.$,o=t.csrfToken=function(){var e;return(e=document.querySelector("meta[name=csrf-token]"))&&e.content},n=t.csrfParam=function(){var e;return(e=document.querySelector("meta[name=csrf-param]"))&&e.content},t.CSRFProtection=function(e){var t;if(null!=(t=o()))return e.setRequestHeader("X-CSRF-Token",t)},t.refreshCSRFTokens=function(){var t,r;if(r=o(),t=n(),null!=r&&null!=t)return e('form input[name="'+t+'"]').forEach(function(e){return e.value=r})}}.call(this),function(){var e,n,o,r;o=t.matches,"function"!=typeof(e=window.CustomEvent)&&((e=function(e,t){var n;return(n=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}).prototype=window.Event.prototype,r=e.prototype.preventDefault,e.prototype.preventDefault=function(){var e;return e=r.call(this),this.cancelable&&!this.defaultPrevented&&Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}}),e}),n=t.fire=function(t,n,o){var r;return r=new e(n,{bubbles:!0,cancelable:!0,detail:o}),t.dispatchEvent(r),!r.defaultPrevented},t.stopEverything=function(e){return n(e.target,"ujs:everythingStopped"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},t.delegate=function(e,t,n,r){return e.addEventListener(n,function(e){var n;for(n=e.target;n instanceof Element&&!o(n,t);)n=n.parentNode;if(n instanceof Element&&!1===r.call(n,e))return e.preventDefault(),e.stopPropagation()})}}.call(this),function(){var e,n,o,r,i,a;r=t.cspNonce,n=t.CSRFProtection,t.fire,e={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},t.ajax=function(e){var t;return e=i(e),t=o(e,function(){var n,o;return o=a(null!=(n=t.response)?n:t.responseText,t.getResponseHeader("Content-Type")),2===Math.floor(t.status/100)?"function"==typeof e.success&&e.success(o,t.statusText,t):"function"==typeof e.error&&e.error(o,t.statusText,t),"function"==typeof e.complete?e.complete(t,t.statusText):void 0}),!(null!=e.beforeSend&&!e.beforeSend(t,e))&&(t.readyState===XMLHttpRequest.OPENED?t.send(e.data):void 0)},i=function(t){return t.url=t.url||location.href,t.type=t.type.toUpperCase(),"GET"===t.type&&t.data&&(t.url.indexOf("?")<0?t.url+="?"+t.data:t.url+="&"+t.data),null==e[t.dataType]&&(t.dataType="*"),t.accept=e[t.dataType],"*"!==t.dataType&&(t.accept+=", */*; q=0.01"),t},o=function(e,t){var o;return(o=new XMLHttpRequest).open(e.type,e.url,!0),o.setRequestHeader("Accept",e.accept),"string"==typeof e.data&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.crossDomain||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),n(o),o.withCredentials=!!e.withCredentials,o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE)return t(o)},o},a=function(e,t){var n,o;if("string"==typeof e&&"string"==typeof t)if(t.match(/\bjson\b/))try{e=JSON.parse(e)}catch(i){}else if(t.match(/\b(?:java|ecma)script\b/))(o=document.createElement("script")).setAttribute("nonce",r()),o.text=e,document.head.appendChild(o).parentNode.removeChild(o);else if(t.match(/\b(xml|html|svg)\b/)){n=new DOMParser,t=t.replace(/;.+/,"");try{e=n.parseFromString(e,t)}catch(i){}}return e},t.href=function(e){return e.href},t.isCrossDomain=function(e){var t,n;(t=document.createElement("a")).href=location.href,n=document.createElement("a");try{return n.href=e,!((!n.protocol||":"===n.protocol)&&!n.host||t.protocol+"//"+t.host==n.protocol+"//"+n.host)}catch(o){return o,!0}}}.call(this),function(){var e,n;e=t.matches,n=function(e){return Array.prototype.slice.call(e)},t.serializeElement=function(t,o){var r,i;return r=[t],e(t,"form")&&(r=n(t.elements)),i=[],r.forEach(function(t){if(t.name&&!t.disabled)return e(t,"select")?n(t.options).forEach(function(e){if(e.selected)return i.push({name:t.name,value:e.value})}):t.checked||-1===["radio","checkbox","submit"].indexOf(t.type)?i.push({name:t.name,value:t.value}):void 0}),o&&i.push(o),i.map(function(e){return null!=e.name?encodeURIComponent(e.name)+"="+encodeURIComponent(e.value):e}).join("&")},t.formElements=function(t,o){return e(t,"form")?n(t.elements).filter(function(t){return e(t,o)}):n(t.querySelectorAll(o))}}.call(this),function(){var e,n,o;n=t.fire,o=t.stopEverything,t.handleConfirm=function(t){if(!e(this))return o(t)},e=function(e){var t,o,r;if(!(r=e.getAttribute("data-confirm")))return!0;if(t=!1,n(e,"confirm")){try{t=confirm(r)}catch(i){}o=n(e,"confirm:complete",[t])}return t&&o}}.call(this),function(){var e,n,o,r,i,a,s,l,c,u,p;c=t.matches,l=t.getData,u=t.setData,p=t.stopEverything,s=t.formElements,t.handleDisabledElement=function(e){if(this.disabled)return p(e)},t.enableElement=function(e){var n;return n=e instanceof Event?e.target:e,c(n,t.linkDisableSelector)?a(n):c(n,t.buttonDisableSelector)||c(n,t.formEnableSelector)?r(n):c(n,t.formSubmitSelector)?i(n):void 0},t.disableElement=function(r){var i;return i=r instanceof Event?r.target:r,c(i,t.linkDisableSelector)?o(i):c(i,t.buttonDisableSelector)||c(i,t.formDisableSelector)?e(i):c(i,t.formSubmitSelector)?n(i):void 0},o=function(e){var t;return null!=(t=e.getAttribute("data-disable-with"))&&(u(e,"ujs:enable-with",e.innerHTML),e.innerHTML=t),e.addEventListener("click",p),u(e,"ujs:disabled",!0)},a=function(e){var t;return null!=(t=l(e,"ujs:enable-with"))&&(e.innerHTML=t,u(e,"ujs:enable-with",null)),e.removeEventListener("click",p),u(e,"ujs:disabled",null)},n=function(n){return s(n,t.formDisableSelector).forEach(e)},e=function(e){var t;return null!=(t=e.getAttribute("data-disable-with"))&&(c(e,"button")?(u(e,"ujs:enable-with",e.innerHTML),e.innerHTML=t):(u(e,"ujs:enable-with",e.value),e.value=t)),e.disabled=!0,u(e,"ujs:disabled",!0)},i=function(e){return s(e,t.formEnableSelector).forEach(r)},r=function(e){var t;return null!=(t=l(e,"ujs:enable-with"))&&(c(e,"button")?e.innerHTML=t:e.value=t,u(e,"ujs:enable-with",null)),e.disabled=!1,u(e,"ujs:disabled",null)}}.call(this),function(){var e;e=t.stopEverything,t.handleMethod=function(n){var o,r,i,a,s,l,c;if(c=(l=this).getAttribute("data-method"))return s=t.href(l),r=t.csrfToken(),o=t.csrfParam(),i=document.createElement("form"),a="<input name='_method' value='"+c+"' type='hidden' />",null==o||null==r||t.isCrossDomain(s)||(a+="<input name='"+o+"' value='"+r+"' type='hidden' />"),a+='<input type="submit" />',i.method="post",i.action=s,i.target=l.target,i.innerHTML=a,i.style.display="none",document.body.appendChild(i),i.querySelector('[type="submit"]').click(),e(n)}}.call(this),function(){var e,n,o,r,i,a,s,l,c,u=[].slice;a=t.matches,o=t.getData,l=t.setData,n=t.fire,c=t.stopEverything,e=t.ajax,r=t.isCrossDomain,s=t.serializeElement,i=function(e){var t;return null!=(t=e.getAttribute("data-remote"))&&"false"!==t},t.handleRemote=function(p){var d,h,f,m,y,g,b;return!i(m=this)||(n(m,"ajax:before")?(b=m.getAttribute("data-with-credentials"),f=m.getAttribute("data-type")||"script",a(m,t.formSubmitSelector)?(d=o(m,"ujs:submit-button"),y=o(m,"ujs:submit-button-formmethod")||m.method,g=o(m,"ujs:submit-button-formaction")||m.getAttribute("action")||location.href,"GET"===y.toUpperCase()&&(g=g.replace(/\?.*$/,"")),"multipart/form-data"===m.enctype?(h=new FormData(m),null!=d&&h.append(d.name,d.value)):h=s(m,d),l(m,"ujs:submit-button",null),l(m,"ujs:submit-button-formmethod",null),l(m,"ujs:submit-button-formaction",null)):a(m,t.buttonClickSelector)||a(m,t.inputChangeSelector)?(y=m.getAttribute("data-method"),g=m.getAttribute("data-url"),h=s(m,m.getAttribute("data-params"))):(y=m.getAttribute("data-method"),g=t.href(m),h=m.getAttribute("data-params")),e({type:y||"GET",url:g,data:h,dataType:f,beforeSend:function(e,t){return n(m,"ajax:beforeSend",[e,t])?n(m,"ajax:send",[e]):(n(m,"ajax:stopped"),!1)},success:function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],n(m,"ajax:success",e)},error:function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],n(m,"ajax:error",e)},complete:function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],n(m,"ajax:complete",e)},crossDomain:r(g),withCredentials:null!=b&&"false"!==b}),c(p)):(n(m,"ajax:stopped"),!1))},t.formSubmitButtonClick=function(){var e,t;if(t=(e=this).form)return e.name&&l(t,"ujs:submit-button",{name:e.name,value:e.value}),l(t,"ujs:formnovalidate-button",e.formNoValidate),l(t,"ujs:submit-button-formaction",e.getAttribute("formaction")),l(t,"ujs:submit-button-formmethod",e.getAttribute("formmethod"))},t.preventInsignificantClick=function(e){var t,n,o,r;if(r=((o=this).getAttribute("data-method")||"GET").toUpperCase(),t=o.getAttribute("data-params"),n=(e.metaKey||e.ctrlKey)&&"GET"===r&&!t,!(0===e.button)||n)return e.stopImmediatePropagation()}}.call(this),function(){var e,n,o,r,i,a,s,l,c,u,p,d,h,f,m;if(a=t.fire,o=t.delegate,l=t.getData,e=t.$,m=t.refreshCSRFTokens,n=t.CSRFProtection,h=t.loadCSPNonce,i=t.enableElement,r=t.disableElement,u=t.handleDisabledElement,c=t.handleConfirm,f=t.preventInsignificantClick,d=t.handleRemote,s=t.formSubmitButtonClick,p=t.handleMethod,"undefined"!=typeof jQuery&&null!==jQuery&&null!=jQuery.ajax){if(jQuery.rails)throw new Error("If you load both jquery_ujs and rails-ujs, use rails-ujs only.");jQuery.rails=t,jQuery.ajaxPrefilter(function(e,t,o){if(!e.crossDomain)return n(o)})}t.start=function(){if(window._rails_loaded)throw new Error("rails-ujs has already been loaded!");return window.addEventListener("pageshow",function(){return e(t.formEnableSelector).forEach(function(e){if(l(e,"ujs:disabled"))return i(e)}),e(t.linkDisableSelector).forEach(function(e){if(l(e,"ujs:disabled"))return i(e)})}),o(document,t.linkDisableSelector,"ajax:complete",i),o(document,t.linkDisableSelector,"ajax:stopped",i),o(document,t.buttonDisableSelector,"ajax:complete",i),o(document,t.buttonDisableSelector,"ajax:stopped",i),o(document,t.linkClickSelector,"click",f),o(document,t.linkClickSelector,"click",u),o(document,t.linkClickSelector,"click",c),o(document,t.linkClickSelector,"click",r),o(document,t.linkClickSelector,"click",d),o(document,t.linkClickSelector,"click",p),o(document,t.buttonClickSelector,"click",f),o(document,t.buttonClickSelector,"click",u),o(document,t.buttonClickSelector,"click",c),o(document,t.buttonClickSelector,"click",r),o(document,t.buttonClickSelector,"click",d),o(document,t.inputChangeSelector,"change",u),o(document,t.inputChangeSelector,"change",c),o(document,t.inputChangeSelector,"change",d),o(document,t.formSubmitSelector,"submit",u),o(document,t.formSubmitSelector,"submit",c),o(document,t.formSubmitSelector,"submit",d),o(document,t.formSubmitSelector,"submit",function(e){return setTimeout(function(){return r(e)},13)}),o(document,t.formSubmitSelector,"ajax:send",r),o(document,t.formSubmitSelector,"ajax:complete",i),o(document,t.formInputClickSelector,"click",f),o(document,t.formInputClickSelector,"click",u),o(document,t.formInputClickSelector,"click",c),o(document,t.formInputClickSelector,"click",s),document.addEventListener("DOMContentLoaded",m),document.addEventListener("DOMContentLoaded",h),window._rails_loaded=!0},window.Rails===t&&a(document,"rails:attachBindings")&&t.start()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd&&define(t)}).call(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ActiveStorage={})}(this,function(e){"use strict";function t(e,t){return e(t={exports:{}},t.exports),t.exports}function n(e){var t=r(document.head,'meta[name="'+e+'"]');if(t)return t.getAttribute("content")}function o(e,t){return"string"==typeof e&&(t=e,e=document),a(e.querySelectorAll(t))}function r(e,t){return"string"==typeof e&&(t=e,e=document),e.querySelector(t)}function i(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},o=e.disabled,r=n.bubbles,i=n.cancelable,a=n.detail,s=document.createEvent("Event");s.initEvent(t,r||!0,i||!0),s.detail=a||{};try{e.disabled=!1,e.dispatchEvent(s)}finally{e.disabled=o}return s}function a(e){return Array.isArray(e)?e:Array.from?Array.from(e):[].slice.call(e)}function s(e,t){if(e&&"function"==typeof e[t]){for(var n=arguments.length,o=Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];return e[t].apply(e,o)}}function l(){I||(I=!0,document.addEventListener("click",c,!0),document.addEventListener("submit",u),document.addEventListener("ajax:before",p))}function c(e){var t=e.target;"INPUT"!=t.tagName&&"BUTTON"!=t.tagName||"submit"!=t.type||!t.form||T.set(t.form,t)}function u(e){d(e)}function p(e){"FORM"==e.target.tagName&&d(e)}function d(e){var t=e.target;if(t.hasAttribute(D))e.preventDefault();else{var n=new j(t),o=n.inputs;o.length&&(e.preventDefault(),t.setAttribute(D,""),o.forEach(f),n.start(function(e){t.removeAttribute(D),e?o.forEach(m):h(t)}))}}function h(e){var t=T.get(e)||r(e,"input[type=submit], button[type=submit]");if(t){var n=t.disabled;t.disabled=!1,t.focus(),t.click(),t.disabled=n}else(t=document.createElement("input")).type="submit",t.style.display="none",e.appendChild(t),t.click(),e.removeChild(t);T["delete"](e)}function f(e){e.disabled=!0}function m(e){e.disabled=!1}function y(){window.ActiveStorage&&l()}var g=t(function(e){var t;t=function(e){function t(e,t){var n=e[0],o=e[1],r=e[2],i=e[3];o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&r|~o&i)+t[0]-680876936|0)<<7|n>>>25)+o|0)&o|~n&r)+t[1]-389564586|0)<<12|i>>>20)+n|0)&n|~i&o)+t[2]+606105819|0)<<17|r>>>15)+i|0)&i|~r&n)+t[3]-1044525330|0)<<22|o>>>10)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&r|~o&i)+t[4]-176418897|0)<<7|n>>>25)+o|0)&o|~n&r)+t[5]+1200080426|0)<<12|i>>>20)+n|0)&n|~i&o)+t[6]-1473231341|0)<<17|r>>>15)+i|0)&i|~r&n)+t[7]-45705983|0)<<22|o>>>10)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&r|~o&i)+t[8]+1770035416|0)<<7|n>>>25)+o|0)&o|~n&r)+t[9]-1958414417|0)<<12|i>>>20)+n|0)&n|~i&o)+t[10]-42063|0)<<17|r>>>15)+i|0)&i|~r&n)+t[11]-1990404162|0)<<22|o>>>10)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&r|~o&i)+t[12]+1804603682|0)<<7|n>>>25)+o|0)&o|~n&r)+t[13]-40341101|0)<<12|i>>>20)+n|0)&n|~i&o)+t[14]-1502002290|0)<<17|r>>>15)+i|0)&i|~r&n)+t[15]+1236535329|0)<<22|o>>>10)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&i|r&~i)+t[1]-165796510|0)<<5|n>>>27)+o|0)&r|o&~r)+t[6]-1069501632|0)<<9|i>>>23)+n|0)&o|n&~o)+t[11]+643717713|0)<<14|r>>>18)+i|0)&n|i&~n)+t[0]-373897302|0)<<20|o>>>12)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&i|r&~i)+t[5]-701558691|0)<<5|n>>>27)+o|0)&r|o&~r)+t[10]+38016083|0)<<9|i>>>23)+n|0)&o|n&~o)+t[15]-660478335|0)<<14|r>>>18)+i|0)&n|i&~n)+t[4]-405537848|0)<<20|o>>>12)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&i|r&~i)+t[9]+568446438|0)<<5|n>>>27)+o|0)&r|o&~r)+t[14]-1019803690|0)<<9|i>>>23)+n|0)&o|n&~o)+t[3]-187363961|0)<<14|r>>>18)+i|0)&n|i&~n)+t[8]+1163531501|0)<<20|o>>>12)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o&i|r&~i)+t[13]-1444681467|0)<<5|n>>>27)+o|0)&r|o&~r)+t[2]-51403784|0)<<9|i>>>23)+n|0)&o|n&~o)+t[7]+1735328473|0)<<14|r>>>18)+i|0)&n|i&~n)+t[12]-1926607734|0)<<20|o>>>12)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o^r^i)+t[5]-378558|0)<<4|n>>>28)+o|0)^o^r)+t[8]-2022574463|0)<<11|i>>>21)+n|0)^n^o)+t[11]+1839030562|0)<<16|r>>>16)+i|0)^i^n)+t[14]-35309556|0)<<23|o>>>9)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o^r^i)+t[1]-1530992060|0)<<4|n>>>28)+o|0)^o^r)+t[4]+1272893353|0)<<11|i>>>21)+n|0)^n^o)+t[7]-155497632|0)<<16|r>>>16)+i|0)^i^n)+t[10]-1094730640|0)<<23|o>>>9)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o^r^i)+t[13]+681279174|0)<<4|n>>>28)+o|0)^o^r)+t[0]-358537222|0)<<11|i>>>21)+n|0)^n^o)+t[3]-722521979|0)<<16|r>>>16)+i|0)^i^n)+t[6]+76029189|0)<<23|o>>>9)+r|0,o=((o+=((r=((r+=((i=((i+=((n=((n+=(o^r^i)+t[9]-640364487|0)<<4|n>>>28)+o|0)^o^r)+t[12]-421815835|0)<<11|i>>>21)+n|0)^n^o)+t[15]+530742520|0)<<16|r>>>16)+i|0)^i^n)+t[2]-995338651|0)<<23|o>>>9)+r|0,o=((o+=((i=((i+=(o^((n=((n+=(r^(o|~i))+t[0]-198630844|0)<<6|n>>>26)+o|0)|~r))+t[7]+1126891415|0)<<10|i>>>22)+n|0)^((r=((r+=(n^(i|~o))+t[14]-1416354905|0)<<15|r>>>17)+i|0)|~n))+t[5]-57434055|0)<<21|o>>>11)+r|0,o=((o+=((i=((i+=(o^((n=((n+=(r^(o|~i))+t[12]+1700485571|0)<<6|n>>>26)+o|0)|~r))+t[3]-1894986606|0)<<10|i>>>22)+n|0)^((r=((r+=(n^(i|~o))+t[10]-1051523|0)<<15|r>>>17)+i|0)|~n))+t[1]-2054922799|0)<<21|o>>>11)+r|0,o=((o+=((i=((i+=(o^((n=((n+=(r^(o|~i))+t[8]+1873313359|0)<<6|n>>>26)+o|0)|~r))+t[15]-30611744|0)<<10|i>>>22)+n|0)^((r=((r+=(n^(i|~o))+t[6]-1560198380|0)<<15|r>>>17)+i|0)|~n))+t[13]+1309151649|0)<<21|o>>>11)+r|0,o=((o+=((i=((i+=(o^((n=((n+=(r^(o|~i))+t[4]-145523070|0)<<6|n>>>26)+o|0)|~r))+t[11]-1120210379|0)<<10|i>>>22)+n|0)^((r=((r+=(n^(i|~o))+t[2]+718787259|0)<<15|r>>>17)+i|0)|~n))+t[9]-343485551|0)<<21|o>>>11)+r|0,e[0]=n+e[0]|0,e[1]=o+e[1]|0,e[2]=r+e[2]|0,e[3]=i+e[3]|0}function n(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function o(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function r(e){var o,r,i,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=c;o+=64)t(u,n(e.substring(o-64,o)));for(r=(e=e.substring(o-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<r;o+=1)i[o>>2]|=e.charCodeAt(o)<<(o%4<<3);if(i[o>>2]|=128<<(o%4<<3),o>55)for(t(u,i),o=0;o<16;o+=1)i[o]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,i[14]=s,i[15]=l,t(u,i),u}function i(e){var n,r,i,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(u,o(e.subarray(n-64,n)));for(r=(e=n-64<c?e.subarray(n-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<r;n+=1)i[n>>2]|=e[n]<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(t(u,i),n=0;n<16;n+=1)i[n]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,i[14]=s,i[15]=l,t(u,i),u}function a(e){var t,n="";for(t=0;t<4;t+=1)n+=f[e>>8*t+4&15]+f[e>>8*t&15];return n}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var n,o=e.length,r=new ArrayBuffer(o),i=new Uint8Array(r);for(n=0;n<o;n+=1)i[n]=e.charCodeAt(n);return t?i:r}function u(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function p(e,t,n){var o=new Uint8Array(e.byteLength+t.byteLength);return o.set(new Uint8Array(e)),o.set(new Uint8Array(t),e.byteLength),n?o:o.buffer}function d(e){var t,n=[],o=e.length;for(t=0;t<o-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function h(){this.reset()}var f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,o){var r,i,a,s,l=this.byteLength,c=t(n,l),u=l;return o!==e&&(u=t(o,l)),c>u?new ArrayBuffer(0):(r=u-c,i=new ArrayBuffer(r),a=new Uint8Array(i),s=new Uint8Array(this,c,r),a.set(s),i)}}(),h.prototype.append=function(e){return this.appendBinary(l(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var o,r=this._buff.length;for(o=64;o<=r;o+=64)t(this._hash,n(this._buff.substring(o-64,o)));return this._buff=this._buff.substring(o-64),this},h.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)i[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(i,r),n=s(this._hash),e&&(n=d(n)),this.reset(),n},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,n){var o,r,i,a=n;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;o=(o=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),i=parseInt(o[1],16)||0,e[14]=r,e[15]=i,t(this._hash,e)},h.hash=function(e,t){return h.hashBinary(l(e),t)},h.hashBinary=function(e,t){var n=s(r(e));return t?d(n):n},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var n,r=p(this._buff.buffer,e,!0),i=r.length;for(this._length+=e.byteLength,n=64;n<=i;n+=64)t(this._hash,o(r.subarray(n-64,n)));return this._buff=n-64<i?new Uint8Array(r.buffer.slice(n-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)i[t>>2]|=o[t]<<(t%4<<3);return this._finish(i,r),n=s(this._hash),e&&(n=d(n)),this.reset(),n},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=u(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var n=s(i(new Uint8Array(e)));return t?d(n):n},h},e.exports=t()}),b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,w=function(){function e(t){b(this,e),this.file=t,this.chunkSize=2097152,this.chunkCount=Math.ceil(this.file.size/this.chunkSize),this.chunkIndex=0}return v(e,null,[{key:"create",value:function(t,n){new e(t).create(n)}}]),v(e,[{key:"create",value:function(e){var t=this;this.callback=e,this.md5Buffer=new g.ArrayBuffer,this.fileReader=new FileReader,this.fileReader.addEventListener("load",function(e){return t.fileReaderDidLoad(e)}),this.fileReader.addEventListener("error",function(e){return t.fileReaderDidError(e)}),this.readNextChunk()}},{key:"fileReaderDidLoad",value:function(e){if(this.md5Buffer.append(e.target.result),!this.readNextChunk()){var t=this.md5Buffer.end(!0),n=btoa(t);this.callback(null,n)}}},{key:"fileReaderDidError",value:function(){this.callback("Error reading "+this.file.name)}},{key:"readNextChunk",value:function(){if(this.chunkIndex<this.chunkCount||0==this.chunkIndex&&0==this.chunkCount){var e=this.chunkIndex*this.chunkSize,t=Math.min(e+this.chunkSize,this.file.size),n=_.call(this.file,e,t);return this.fileReader.readAsArrayBuffer(n),this.chunkIndex++,!0}return!1}}]),e}(),S=function(){function e(t,o,r){var i=this;b(this,e),this.file=t,this.attributes={filename:t.name,content_type:t.type,byte_size:t.size,checksum:o},this.xhr=new XMLHttpRequest,this.xhr.open("POST",r,!0),this.xhr.responseType="json",this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("Accept","application/json"),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xhr.setRequestHeader("X-CSRF-Token",n("csrf-token")),this.xhr.addEventListener("load",function(e){return i.requestDidLoad(e)}),this.xhr.addEventListener("error",function(e){return i.requestDidError(e)})}return v(e,[{key:"create",value:function(e){this.callback=e,this.xhr.send(JSON.stringify({blob:this.attributes}))}},{key:"requestDidLoad",value:function(e){if(this.status>=200&&this.status<300){var t=this.response,n=t.direct_upload;delete t.direct_upload,this.attributes=t,this.directUploadData=n,this.callback(null,this.toJSON())}else this.requestDidError(e)}},{key:"requestDidError",value:function(){this.callback('Error creating Blob for "'+this.file.name+'". Status: '+this.status)}},{key:"toJSON",value:function(){var e={};for(var t in this.attributes)e[t]=this.attributes[t];return e}},{key:"status",get:function(){return this.xhr.status}},{key:"response",get:function(){var e=this.xhr,t=e.responseType,n=e.response;return"json"==t?n:JSON.parse(n)}}]),e}(),k=function(){function e(t){var n=this;b(this,e),this.blob=t,this.file=t.file;var o=t.directUploadData,r=o.url,i=o.headers;for(var a in this.xhr=new XMLHttpRequest,this.xhr.open("PUT",r,!0),this.xhr.responseType="text",i)this.xhr.setRequestHeader(a,i[a]);this.xhr.addEventListener("load",function(e){return n.requestDidLoad(e)}),this.xhr.addEventListener("error",function(e){return n.requestDidError(e)})}return v(e,[{key:"create",value:function(e){this.callback=e,this.xhr.send(this.file.slice())}},{key:"requestDidLoad",value:function(e){var t=this.xhr,n=t.status,o=t.response;n>=200&&n<300?this.callback(null,o):this.requestDidError(e)}},{key:"requestDidError",value:function(){this.callback('Error storing "'+this.file.name+'". Status: '+this.xhr.status)}}]),e}(),C=0,E=function(){function e(t,n,o){b(this,e),this.id=++C,this.file=t,this.url=n,this.delegate=o}return v(e,[{key:"create",value:function(e){var t=this;w.create(this.file,function(n,o){if(n)e(n);else{var r=new S(t.file,o,t.url);s(t.delegate,"directUploadWillCreateBlobWithXHR",r.xhr),r.create(function(n){if(n)e(n);else{var o=new k(r);s(t.delegate,"directUploadWillStoreFileWithXHR",o.xhr),o.create(function(t){t?e(t):e(null,r.toJSON())})}})}})}}]),e}(),x=function(){function e(t,n){b(this,e),this.input=t,this.file=n,this.directUpload=new E(this.file,this.url,this),this.dispatch("initialize")}return v(e,[{key:"start",value:function(e){var t=this,n=document.createElement("input");n.type="hidden",n.name=this.input.name,this.input.insertAdjacentElement("beforebegin",n),this.dispatch("start"),this.directUpload.create(function(o,r){o?(n.parentNode.removeChild(n),t.dispatchError(o)):n.value=r.signed_id,t.dispatch("end"),e(o)})}},{key:"uploadRequestDidProgress",value:function(e){var t=e.loaded/e.total*100;t&&this.dispatch("progress",{progress:t})}},{key:"dispatch",value:function(e){
var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return t.file=this.file,t.id=this.directUpload.id,i(this.input,"direct-upload:"+e,{detail:t})}},{key:"dispatchError",value:function(e){this.dispatch("error",{error:e}).defaultPrevented||alert(e)}},{key:"directUploadWillCreateBlobWithXHR",value:function(e){this.dispatch("before-blob-request",{xhr:e})}},{key:"directUploadWillStoreFileWithXHR",value:function(e){var t=this;this.dispatch("before-storage-request",{xhr:e}),e.upload.addEventListener("progress",function(e){return t.uploadRequestDidProgress(e)})}},{key:"url",get:function(){return this.input.getAttribute("data-direct-upload-url")}}]),e}(),A="input[type=file][data-direct-upload-url]:not([disabled])",j=function(){function e(t){b(this,e),this.form=t,this.inputs=o(t,A).filter(function(e){return e.files.length})}return v(e,[{key:"start",value:function(e){var t=this,n=this.createDirectUploadControllers(),o=function r(){var o=n.shift();o?o.start(function(n){n?(e(n),t.dispatch("end")):r()}):(e(),t.dispatch("end"))};this.dispatch("start"),o()}},{key:"createDirectUploadControllers",value:function(){var e=[];return this.inputs.forEach(function(t){a(t.files).forEach(function(n){var o=new x(t,n);e.push(o)})}),e}},{key:"dispatch",value:function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return i(this.form,"direct-uploads:"+e,{detail:t})}}]),e}(),D="data-direct-uploads-processing",T=new WeakMap,I=!1;setTimeout(y,1),e.start=l,e.DirectUpload=E,Object.defineProperty(e,"__esModule",{value:!0})}),function(){var e=this;(function(){(function(){var e=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(e){var n;return null==e&&(e=null!=(n=this.getConfig("url"))?n:this.INTERNAL.default_mount_path),new t.Consumer(this.createWebSocketURL(e))},getConfig:function(e){var t;return null!=(t=document.head.querySelector("meta[name='action-cable-"+e+"']"))?t.getAttribute("content"):void 0},createWebSocketURL:function(e){var t;return e&&!/^wss?:/i.test(e)?((t=document.createElement("a")).href=e,t.href=t.href,t.protocol=t.protocol.replace("http","ws"),t.href):e},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var t,n;if(t=1<=arguments.length?e.call(arguments,0):[],this.debugging)return t.push(Date.now()),(n=this.logger).log.apply(n,["[ActionCable]"].concat(e.call(t)))}}}).call(this)}).call(e);var t=e.ActionCable;(function(){(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};t.ConnectionMonitor=function(){function n(t){this.connection=t,this.visibilityDidChange=e(this.visibilityDidChange,this),this.reconnectAttempts=0}var o,r,i;return n.pollInterval={min:3,max:30},n.staleThreshold=6,n.prototype.start=function(){if(!this.isRunning())return this.startedAt=r(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),t.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},n.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=r(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),t.log("ConnectionMonitor stopped")},n.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},n.prototype.recordPing=function(){return this.pingedAt=r()},n.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,t.log("ConnectionMonitor recorded connect")},n.prototype.recordDisconnect=function(){return this.disconnectedAt=r(),t.log("ConnectionMonitor recorded disconnect")},n.prototype.startPolling=function(){return this.stopPolling(),this.poll()},n.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},n.prototype.poll=function(){return this.pollTimeout=setTimeout((e=this,function(){return e.reconnectIfStale(),e.poll()}),this.getPollInterval());var e},n.prototype.getPollInterval=function(){var e,t,n,r;return n=(r=this.constructor.pollInterval).min,t=r.max,e=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*o(e,n,t))},n.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return t.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+i(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?t.log("ConnectionMonitor skipping reopening recent disconnect"):(t.log("ConnectionMonitor reopening"),this.connection.reopen())},n.prototype.connectionIsStale=function(){var e;return i(null!=(e=this.pingedAt)?e:this.startedAt)>this.constructor.staleThreshold},n.prototype.disconnectedRecently=function(){return this.disconnectedAt&&i(this.disconnectedAt)<this.constructor.staleThreshold},n.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout((e=this,function(){if(e.connectionIsStale()||!e.connection.isOpen())return t.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),e.connection.reopen()}),200);var e},r=function(){return(new Date).getTime()},i=function(e){return(r()-e)/1e3},o=function(e,t,n){return Math.max(t,Math.min(n,e))},n}()}).call(this),function(){var e,n,o,r,i,a=[].slice,s=function(e,t){return function(){return e.apply(t,arguments)}},l=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};r=t.INTERNAL,n=r.message_types,o=r.protocols,i=2<=o.length?a.call(o,0,e=o.length-1):(e=0,[]),o[e++],t.Connection=function(){function e(e){this.consumer=e,this.open=s(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new t.ConnectionMonitor(this),this.disconnected=!0}return e.reopenDelay=500,e.prototype.send=function(e){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(e)),!0)},e.prototype.open=function(){return this.isActive()?(t.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(t.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+o),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new t.WebSocket(this.consumer.url,o),this.installEventHandlers(),this.monitor.start(),!0)},e.prototype.close=function(e){var t;if((null!=e?e:{allowReconnect:!0}).allowReconnect||this.monitor.stop(),this.isActive())return null!=(t=this.webSocket)?t.close():void 0},e.prototype.reopen=function(){var e;if(t.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(n){return e=n,t.log("Failed to reopen WebSocket",e)}finally{t.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},e.prototype.getProtocol=function(){var e;return null!=(e=this.webSocket)?e.protocol:void 0},e.prototype.isOpen=function(){return this.isState("open")},e.prototype.isActive=function(){return this.isState("open","connecting")},e.prototype.isProtocolSupported=function(){var e;return e=this.getProtocol(),l.call(i,e)>=0},e.prototype.isState=function(){var e,t;return t=1<=arguments.length?a.call(arguments,0):[],e=this.getState(),l.call(t,e)>=0},e.prototype.getState=function(){var e,t;for(t in WebSocket)if(WebSocket[t]===(null!=(e=this.webSocket)?e.readyState:void 0))return t.toLowerCase();return null},e.prototype.installEventHandlers=function(){var e,t;for(e in this.events)t=this.events[e].bind(this),this.webSocket["on"+e]=t},e.prototype.uninstallEventHandlers=function(){var e;for(e in this.events)this.webSocket["on"+e]=function(){}},e.prototype.events={message:function(e){var t,o,r;if(this.isProtocolSupported())switch(t=(r=JSON.parse(e.data)).identifier,o=r.message,r.type){case n.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case n.ping:return this.monitor.recordPing();case n.confirmation:return this.subscriptions.notify(t,"connected");case n.rejection:return this.subscriptions.reject(t);default:return this.subscriptions.notify(t,"received",o)}},open:function(){if(t.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return t.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(){if(t.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return t.log("WebSocket onerror event")}},e}()}.call(this),function(){var e=[].slice;t.Subscriptions=function(){function n(e){this.consumer=e,this.subscriptions=[]}return n.prototype.create=function(e,n){var o,r,i;return r="object"==typeof(o=e)?o:{channel:o},i=new t.Subscription(this.consumer,r,n),this.add(i)},n.prototype.add=function(e){return this.subscriptions.push(e),this.consumer.ensureActiveConnection(),this.notify(e,"initialized"),this.sendCommand(e,"subscribe"),e},n.prototype.remove=function(e){return this.forget(e),this.findAll(e.identifier).length||this.sendCommand(e,"unsubscribe"),e},n.prototype.reject=function(e){var t,n,o,r,i;for(r=[],t=0,n=(o=this.findAll(e)).length;t<n;t++)i=o[t],this.forget(i),this.notify(i,"rejected"),r.push(i);return r},n.prototype.forget=function(e){var t;return this.subscriptions=function(){var n,o,r,i;for(i=[],n=0,o=(r=this.subscriptions).length;n<o;n++)(t=r[n])!==e&&i.push(t);return i}.call(this),e},n.prototype.findAll=function(e){var t,n,o,r,i;for(r=[],t=0,n=(o=this.subscriptions).length;t<n;t++)(i=o[t]).identifier===e&&r.push(i);return r},n.prototype.reload=function(){var e,t,n,o,r;for(o=[],e=0,t=(n=this.subscriptions).length;e<t;e++)r=n[e],o.push(this.sendCommand(r,"subscribe"));return o},n.prototype.notifyAll=function(){var t,n,o,r,i,a,s;for(n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],a=[],o=0,r=(i=this.subscriptions).length;o<r;o++)s=i[o],a.push(this.notify.apply(this,[s,n].concat(e.call(t))));return a},n.prototype.notify=function(){var t,n,o,r,i,a,s;for(a=arguments[0],n=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],i=[],o=0,r=(s="string"==typeof a?this.findAll(a):[a]).length;o<r;o++)a=s[o],i.push("function"==typeof a[n]?a[n].apply(a,t):void 0);return i},n.prototype.sendCommand=function(e,t){var n;return n=e.identifier,this.consumer.send({command:t,identifier:n})},n}()}.call(this),function(){t.Subscription=function(){function e(e,n,o){this.consumer=e,null==n&&(n={}),this.identifier=JSON.stringify(n),t(this,o)}var t;return e.prototype.perform=function(e,t){return null==t&&(t={}),t.action=e,this.send(t)},e.prototype.send=function(e){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(e)})},e.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},t=function(e,t){var n,o;if(null!=t)for(n in t)o=t[n],e[n]=o;return e},e}()}.call(this),function(){t.Consumer=function(){function e(e){this.url=e,this.subscriptions=new t.Subscriptions(this),this.connection=new t.Connection(this)}return e.prototype.send=function(e){return this.connection.send(e)},e.prototype.connect=function(){return this.connection.open()},e.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},e.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},e}()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd&&define(t)}.call(this),function(){this.App||(this.App={}),App.cable=ActionCable.createConsumer()}.call(this);const pointsJSON={lawn_size:{"small change ~100 sq ft reduction":13,"medium change ~ 500 sq ft reduction":67,"large change ~ 1,000 sq ft reduction":133},mower_type:{yes:0,no:0},mower_switch:{no:0,yes:396},mowing_frequency:{no:0,"two  less":220,"five less ":280,"ten less":320},fertilizer:{no:0,yes:0},fertilizer_applications:{no:0,"1 less":20,"2 less":40,"3 less ":60},leaf_cleanup:{no:0,yes:0},leaf_cleanup_gas_blower_switch:{no:0,yes:133},water_heater_type:{"fuel oil":0,"nat gas":0,propane:0,electric:0,"heat pump":0},hot_water_assessment:{yes:50,no:0},replace_water_heater:{yes:1750,no:0},solar_panels:{no:0,yes:0},solar_assessment:{yes:1175,no:0},install_solar_panels:{yes:5875,no:0},bulbs_incandescent:{yes:0,no:0},bulbs_swap:{yes:985,no:0},bulbs_replace_leds:{some:250,half:490,all:985},appliances_replace_refrigerator:{"i already use a energy star product":0,no:0,yes:1},appliances_replace_washer:{"i already use a energy star product":0,no:0,yes:1},cold_water_wash_loads:{no:0,"once per week":48,"twice per week":95,"three times per week":143},line_or_rack_dry_loads:{no:0,"once per week":86,"twice per week":172,"three times per week":258},extra_refrigerator:{no:0,yes:42},extra_refrigerator_age:{">20 years old":0,"15-20 years old":0,"10-15 years old":0,"0-10 years old":0},extra_refrigerator_pickup:{no:0,yes:350},unplug_refrigerator:{no:0},smart_power_strips:{no:0,yes:50},install_electricity_monitor:{no:0,yes:50},transportation_car_type:{"electric/hybrid":0,"gas/diesel ":42},reduce_total_mileage:{},carpooling_increase:{no:0},carpooling_amount:{},transportation_public:{no:0},transportation_public_amount:{},transportation_telecommute:{no:0},transportation_telecommute_amount:{},transportation_commute_bike_walk:{no:0},transportation_commute_bike_walk_amount:{},transportation_flights:{no:0,yes:0},eating_switch_meals:{no:0,yes:42},eating_switch_meals_amount:{none:0,"1 to 2 meals":173,"3 to 4 meals":690,"5 to 6 meals":863},family_size:{blank:0},buy_sell_used:{usually:75,sometimes:50,rarely:25,never:0},reuse_containers:{usually:75,sometimes:50,rarely:25,never:0},buy_bulk:{usually:75,sometimes:50,rarely:25,never:0},buy_recycled:{usually:75,sometimes:50,rarely:25,never:0},heating_system_type:{"fuel oil":0,"nat gas":0,propane:0,wood:0,"electric resistance":0,"heat pump":0},heating_system_assessment:{no:0,yes:100},upgrade_heating_system:{no:0,yes:3048,"yes, high efficient heat pump ":11140},weatherized:{no:0,yes:0},energy_audit:{no:0,yes:500},insulate_home:{no:0,yes:3428},install_programmable_thermostats:{"i already use programmable thermostats":0,no:0,yes:3428}};$(()=>{loadSurvey(),loadCurrentUserData()});const surveyJSON={pages:[{name:"yard",elements:[{type:"radiogroup",name:"lawn_size",title:"Will you choose to reduce the size of your lawn?",choices:["Small Change ~100 sq ft reduction","Medium Change ~ 500 sq ft reduction","Large Change ~ 1,000 sq ft reduction"]},{type:"radiogroup",name:"mower_type",title:"Do you use a gas mower?",choices:["yes","no"]},{type:"radiogroup",name:"mower_switch",visibleIf:'{mower_type} = "yes"',title:"Will you choose to switch away from a gas mower?",choices:["yes","no"]},{type:"radiogroup",name:"mowing_frequency",visibleIf:'{mower_type} = "yes"',title:"Will you choose to mow your lawn less in the summer?",choices:["yes","no"]},{type:"radiogroup",name:"fertilizer",title:"Do you use fertilizer on your yard?",choices:["yes","no"]},{type:"radiogroup",name:"fertilizer_applications",visibleIf:'{fertilizer} = "yes"',title:"Will you choose to reduce your fertilizer applications this year?",choices:["no","1less","2less","3less"]},{type:"radiogroup",name:"leaf_cleanup",title:"Do you use a gas blower to clean leaves?",choices:["yes","no"]},{type:"radiogroup",name:"leaf_cleanup_gas_blower_switch",visibleIf:'{leaf_cleanup} = "yes"',title:"Will you choose to switch from gas blower to rake or electric blower?",choices:["yes","no"]}],title:"Yard/Landscaping"},{name:"water",elements:[{type:"radiogroup",name:"water_heater_type",title:"What type of water heater do you have in your home?",choices:[{value:"Fuel Oil",text:"Fuel Oil "},"Nat Gas","Propane","Electric","Heat Pump"]},{type:"radiogroup",name:"hot_water_assessment",visibleIf:'{water_heater_type} = "Fuel Oil" or {water_heater_type} = "Propane" or {water_heater_type} = "Electric"',title:"Will you choose to sign up for a free hot water assessment?",choices:["yes","no"]},{type:"radiogroup",name:"replace_water_heater",visibleIf:'{water_heater_type} = "Fuel Oil" or {water_heater_type} = "Propane" or {water_heater_type} = "Electric"',title:"Will you choose to replace your current water heater w/ heat pump?",choices:["yes","no"]}],title:"Water Heating"},{name:"solar",elements:[{type:"radiogroup",name:"solar_panels",title:"Do you have a solar panel array?",choices:["yes","no"]},{type:"radiogroup",name:"solar_assessment",visibleIf:'{solar_panels} = "no"',title:"Will you choose to sign up for a free solar assessment?",choices:["yes","no"]},{type:"radiogroup",name:"install_solar_panels",visibleIf:'{solar_panels} = "no"',title:"Will you choose to install a solar panel array?",choices:["yes","no"]}],title:"Solar-power"},{name:"lighting",elements:[{type:"radiogroup",name:"bulbs_incandescent",title:"Do you have more than 10 incandescent/halogen bulbs in your home?",choices:["yes","no"]},{type:"radiogroup",name:"bulbs_swap",title:"Will you choose to sign up for a free light bulb swap?",choices:["yes","no"]},{type:"radiogroup",name:"bulbs_replace_leds",title:"Will you choose to replace your bulbs with LED bulbs",choices:["some","half","all"]}],title:"Lighting"},{name:"appliances",elements:[{type:"radiogroup",name:"appliances_replace_refrigerator",title:"Will you choose to upgrade to an Energy Star model refrigerator? ",choices:["I already use a Energy Star Product","yes","no"]},{type:"radiogroup",name:"appliances_replace_washer",title:"Will you choose to upgrade to an Energy Star model washer? ",choices:["I already use a Energy Star Product","yes","no"]},{type:"radiogroup",name:"cold_water_wash_loads",title:"Will you choose to use replace hot water washes with cold washes?",choices:["no","once per week","twice per week","three times per week"]},{type:"radiogroup",name:"line_or_rack_dry_loads",title:"Will you choose to use dry clothes by line or rack dry instead of a dryer?",choices:["no","once per week","twice per week","three times per week"]},{type:"radiogroup",name:"extra_refrigerator",title:"Do you have an extra refrigerator?",choices:["yes","no"]},{type:"radiogroup",name:"extra_refrigerator_age",visibleIf:'{extra_refrigerator} = "yes"',title:"What is the age of your extra refrigerator?",choices:[">20 years old","15-20 years old","10-15 years old","0-10 years old"]},{type:"radiogroup",name:"extra_refrigerator_pickup",visibleIf:'{extra_refrigerator} = "yes"',title:"Will you choose to sign up for a free extra refrigerator pick-up?",choices:["yes","no"]},{type:"radiogroup",name:"unplug_refrigerator",visibleIf:'{extra_refrigerator} = "yes"',title:"Will you choose to unplug your extra fridge temporarily?",choices:["yes","no"]},{type:"radiogroup",name:"smart_power_strips",title:"Will you choose to install smart power strips to kill phantom loads?",choices:["yes","no"]},{type:"radiogroup",name:"install_electricity_monitor",title:"Will you choose to install an electricity monitor to find energy hogs?",choices:["yes","no"]}],title:"Home Appliances"},{name:"transportation",elements:[{type:"radiogroup",name:"transportation_car_type",title:"What type of car do you drive?",choices:["electric/hybrid","gas/diesel"]},{type:"rating",name:"reduce_total_mileage",visibleIf:'{transportation_car_type} = "gas/diesel"',title:"By how many miles are you willing to reduce the miles you travel by car/auto each year?",rateMin:0,rateMax:2e4,rateStep:5e3,minRateDescription:"No reduction in mileage",maxRateDescription:"reduction in mileage"},{type:"radiogroup",name:"carpooling_increase",visibleIf:'{transportation_car_type} = "gas/diesel"',title:"Can you choose to carpool more often?",choices:["yes","no"]},{type:"rating",name:"carpooling_amount",visibleIf:'{carpooling_increase} = "yes"',title:"if so how much?",rateMax:6},{type:"radiogroup",name:"transportation_public",visibleIf:'{transportation_car_type} = "gas/diesel"',title:"Can you choose public/train/bus transportation more often?",choices:["yes","no"]},{type:"rating",name:"transportation_public_amount",visibleIf:'{transportation_public} = "yes"',title:"if so how much?",rateMax:6},{type:"radiogroup",name:"transportation_telecommute",title:"Can you choose to telecommute more often?",choices:["yes","no"]},{type:"rating",name:"transportation_telecommute_amount",visibleIf:'{transportation_telecommute} = "yes"',title:"How many times can you choose public transportation per week?",rateMax:6},{type:"radiogroup",name:"transportation_commute_bike_walk",visibleIf:'{transportation_car_type} = "gas/diesel"',title:"Can you choose to bike or walk your commute more often?",choices:["yes","no"]},{type:"rating",name:"transportation_commute_bike_walk_amount",visibleIf:'{transportation_commute_bike_walk} = "yes"',title:"if so how much?",rateMax:6},{type:"radiogroup",name:"transportation_flights",title:"Can you choose to take fewer flights per year?",choices:["yes","no"]}],title:"Transportation"},{name:"eating",elements:[{type:"radiogroup",name:"eating_switch_meals",title:"Will you choose to change the food consumed in your family meals to lower emissions?",choices:["yes","no"]},{type:"radiogroup",name:"eating_switch_meals_amount",visibleIf:'{eating_switch_meals} = "yes"',title:"How many meals per week are you willing to switch from Beef/Lamb/Pork/Poultry/Cheese/Fish/Seafood to Vegetarian (w/ cheese, eggs) Vegetarian/Vegan (non-dairy)?",choices:["1 - 2 meals","3 - 4 meals","5 - 6 meals"]},{type:"rating",name:"family_size",visibleIf:'{eating_switch_meals} = "yes"',title:"To estimate servings, how many members of your family are there?",rateMax:6}],title:"Eating"},{name:"recycle",elements:[{type:"radiogroup",name:"buy_sell_used",title:"When possible, will you buy or sell used goods rather than new?",choices:["usually","sometimes","rarely","never"]},{type:"radiogroup",name:"reuse_containers",title:"When possible, will you use refillable containers (bags, mugs, bottles)?",choices:["usually","sometimes","rarely","never"]},{type:"radiogroup",name:"buy_bulk",title:"When possible, will you buy in bulk to minimize packaging?",choices:["usually","sometimes","rarely","never"]},{type:"radiogroup",name:"buy_recycled",title:"When possible, will you buy items made from recycled materials?",choices:["usually","sometimes","rarely","never"]}],title:"Reduce/Reuse"},{name:"heating_cooling",elements:[{type:"radiogroup",name:"heating_system_type",title:"What is the primary heating system type in your home?",choices:["Fuel Oil","Nat Gas","Propane","Wood","Electric Resistance","Heat Pump"]},{type:"radiogroup",name:"heating_system_assessment",visibleIf:'{heating_system_type} <> "Heat Pump"',title:"Will you choose to sign up for a free heating system assessment?",choices:["yes","no"]},{type:"radiogroup",name:"upgrade_heating_system",visibleIf:'{heating_system_type} <> "Heat Pump"',title:"Will you choose to upgrade to a more efficient system?",choices:["no","yes, higher efficiency system","yes, high efficiency heat pump"]},{type:"radiogroup",name:"weatherized",title:"Is your home well insulated/weatherized?",choices:["yes","no"]},{type:"radiogroup",name:"energy_audit",visibleIf:'{weatherized} = "no"',title:"Will you choose to sign up for a free energy audit?",choices:["yes","no"]},{type:"radiogroup",name:"insulate_home",visibleIf:'{weatherized} = "no"',title:"Will you choose to better insulate your home?",choices:["yes","no"]},{type:"radiogroup",name:"install_programmable_thermostats",title:"Will you choose to install programmable thermostats?",choices:["yes","no"]}],title:"Home Heating and Cooling"}],questionStartIndex:"1"};